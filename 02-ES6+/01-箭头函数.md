# 箭头函数（Arrow Function）

> 箭头函数是ES6引入的一种简洁函数定义方式，具有更精炼的语法和词法绑定的 `this` 特性，常用于回调和函数式编程。

## 概念介绍

箭头函数使用 `=>` 语法定义，是匿名函数表达式的一种；它没有自己的 `this`、`arguments`、`super` 和 `new.target`，内部 `this` 继承自定义时的外层作用域。

## 基本语法

```javascript
/**
 * @description 无参数函数，返回随机数
 * @return {number}
 */
const getRandom = () => Math.random();

/**
 * @description 单参数函数，计算平方
 * @param {number} n
 * @return {number}
 */
const square = n => n * n;

/**
 * @description 多参数函数，计算两数之和
 * @param {number} a
 * @param {number} b
 * @return {number}
 */
const add = (a, b) => a + b;

/**
 * @description 多行函数体需显式 return
 * @param {number} x
 * @param {number} y
 * @return {number}
 */
const compute = (x, y) => {
  const result = x * y;
  return result + 5;
};

/**
 * @description 返回对象字面量时要用括号包裹
 * @param {string} name
 * @param {number} age
 * @return {{name: string, age: number}}
 */
const createPerson = (name, age) => ({ name, age });
```

## 核心特性

1. **词法绑定 `this`**：`this` 在定义时确定，继承自上层作用域。
2. **无 `arguments` 对象**：可使用剩余参数 `(...args)` 代替。
3. **不可构造**：没有 `prototype`，无法用 `new` 调用。
4. **不可用作 Generator**：不能使用 `yield`。
5. **`call/apply/bind` 无效**：无法改变 `this` 指向。

## 实战案例

### 简短回调
```javascript
/**
 * @description 使用箭头函数精简数组方法
 * @param {number[]} arr
 * @return {number[]}
 */
const doubleArr = arr => arr.map(n => n * 2);

const evens = arr => arr.filter(n => n % 2 === 0);
const sum = arr => arr.reduce((acc, n) => acc + n, 0);
```

### 保留外层 `this`
```javascript
/**
 * @description 在类方法中使用箭头函数保留 this
 */
class Timer {
  constructor() {
    this.count = 0;
  }

  start() {
    // 箭头函数捕获外层 this
    this.id = setInterval(() => {
      this.count++;
      console.log(this.count);
    }, 1000);
  }

  stop() {
    clearInterval(this.id);
  }
}
```

### 函数式编程
```javascript
/**
 * @description 函数组合示例
 * @param {...Function} fns
 * @return {Function}
 */
const compose = (...fns) => x => fns.reduceRight((v, fn) => fn(v), x);

/**
 * @description 柯里化示例
 * @param {Function} fn
 * @return {Function}
 */
const curry = fn => {
  function curried(...args) {
    return args.length >= fn.length
      ? fn.apply(this, args)
      : (...more) => curried.apply(this, [...args, ...more]);
  }
  return curried;
};
```

## 兼容性说明

| 引擎/浏览器 | 版本       |
| ---------- | ---------- |
| Chrome     | 45+        |
| Firefox    | 22+        |
| Safari     | 10+        |
| Edge       | 全版本支持 |
| IE         | 不支持     |

## 面试常见问题

### 1. 箭头函数与普通函数的 `this` 有何区别？
**答**：箭头函数的 `this` 在定义时绑定为外层上下文的 `this`，不会因调用方式改变；而普通函数的 `this` 动态绑定，取决于调用方式（如直接调用、方法调用、`call/apply`、构造函数等）。

### 2. 如何在箭头函数中访问参数？
**答**：箭头函数没有 `arguments` 对象，可使用剩余参数语法：
```javascript
const fn = (...args) => args;
```

### 3. 为什么箭头函数不能作为构造函数？
**答**：因为箭头函数没有 `prototype`，且 `this` 值在定义时已确定，调用 `new` 时无法创建实例，执行会报错。

### 4. 使用 `call/apply/bind` 是否能改变箭头函数的 `this`？
**答**：不能。`call/apply/bind` 只传递参数，不会影响箭头函数的 `this`，它始终指向定义时的上下文。

## 常见陷阱

1. **对象方法中的 this 指向错误**
```javascript
/**
 * @description 陷阱示例：对象方法使用箭头函数导致 this 绑定错误
 */
const obj = {
  name: 'Alice',
  greet: () => {
    console.log(this.name); // undefined，this 不指向 obj
  }
};
obj.greet();
```

2. **原型方法中的 this 指向错误**
```javascript
/**
 * @description 陷阱示例：在原型上定义箭头函数方法导致 this 丢失
 */
function Person(name) {
  this.name = name;
}
Person.prototype.sayName = () => {
  console.log(this.name); // undefined，this 不指向 Person 实例
};
new Person('Bob').sayName();
```

3. **事件处理器中的 this 指向错误**
```javascript
/**
 * @description 陷阱示例：事件处理器使用箭头函数导致 this 指向元素失效
 */
const button = document.querySelector('button');
button.addEventListener('click', () => {
  console.log(this); // undefined 或全局对象，无法访问 button
});
```

4. **无 arguments 对象**
```javascript
/**
 * @description 陷阱示例：访问 arguments 失败
 */
const fn = () => {
  console.log(arguments); // ReferenceError: arguments is not defined
};
fn(1, 2, 3);
```

5. **无法作为构造函数**
```javascript
/**
 * @description 陷阱示例：箭头函数不能用作构造函数
 */
const Foo = () => {};
// new Foo(); // TypeError: Foo is not a constructor
```

## 学习资源

- MDN - [箭头函数](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions)
- JavaScript.info - [箭头函数](https://zh.javascript.info/arrow-functions)
- TC39 Proposal - [箭头函数](https://github.com/tc39/proposal-arrow-functions)